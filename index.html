<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ironman 2023 Project</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #F1FAEE;
            color: #1D3557;
            height: 100%;
            overflow-x: hidden;
        }

        * {
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        header {
            background-color: #1D3557;
            color: #F1FAEE;
            padding: 20px;
            text-align: center;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
        }

        .open-btn {
            font-size: 20px;
            cursor: pointer;
            background-color: #E63946;
            color: #F1FAEE;
            border: none;
            padding: 15px;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 4;
            border-radius: 50%;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s ease;
        }

        .open-btn:hover {
            background-color: #457B9D;
            transform: scale(1.1);
        }

        .sidebar {
            height: 100%;
            width: 250px;
            position: fixed;
            top: 0;
            left: -250px;
            background-color: #E63946;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
            font-family: 'Oswald', sans-serif;
            z-index: 3;
        }

        .sidebar a {
            padding: 15px 20px;
            text-decoration: none;
            font-size: 1.8em;
            color: #F1FAEE;
            display: block;
            transition: 0.3s;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar a:hover {
            background-color: #457B9D;
            padding-left: 25px;
        }

        .sidebar a.close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.8em;
            padding: 5px 10px;
        }

        .main-content {
            margin-left: 0;
            padding: 40px;
            transition: margin-left 0.5s ease;
            min-height: calc(100vh - 160px);
        }

        .content {
            opacity: 0;
            transition: opacity 0.5s ease, transform 0.5s ease;
            transform: translateY(20px);
            padding: 40px 0;
            text-align: center;
            display: none;
        }

        .content.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .content h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            color: #1D3557;
        }

        .description-box {
            background-color: #A8DADC;
            color: #1D3557;
            padding: 20px;
            border-radius: 10px;
            margin: 40px auto;
            max-width: 800px;
            font-size: 1.2em;
            line-height: 1.6;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .description-box:hover {
            transform: scale(1.02);
        }

        .description-box h3 {
            color: #1D3557;
            margin-bottom: 15px;
        }

        /* Visualization Styles */
        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 500px), 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .visualization-container {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
            height: 500px;
            margin-bottom: 20px;
        }

        .visualization-container:hover {
            transform: translateY(-5px);
        }

        .visualization-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .visualization-title {
            background: #457B9D;
            color: #F1FAEE;
            padding: 10px;
            margin: 0;
            font-family: 'Oswald', sans-serif;
            font-size: 1.2em;
        }

        footer {
            background-color: #1D3557;
            color: #F1FAEE;
            text-align: center;
            padding: 20px;
            position: relative;
            width: 100%;
            z-index: 2;
        }

        #mySidebar.show {
            left: 0;
        }
        
        #main.active {
            margin-left: 250px;
        }

        .progress-bar {
            width: 0;
            height: 5px;
            background-color: #E63946;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 5;
        }

        .stat-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-top: 40px;
        }

        .stat-box {
            background-color: #457B9D;
            color: #F1FAEE;
            padding: 20px;
            border-radius: 10px;
            margin: 10px;
            width: 200px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-5px);
        }

        .stat-box h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .stat-box p {
            font-size: 2em;
            font-weight: bold;
        }

        .stat-box small {
            display: block;
            margin-top: 5px;
            color: #F1FAEE;
            font-size: 0.8em;
            opacity: 0.8;
        }

        .animate-number {
            display: inline-block;
        }

        .course-overview {
            margin-top: 40px;
        }

        .course-overview h3 {
            text-align: center;
            color: #1D3557;
            margin: 40px 0 20px;
        }

        .visualization-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* Mobile-specific image handling */
        @media screen and (max-width: 768px) {
            .visualization-image {
                object-fit: cover;
                object-position: center;
            }
        }

        .visualization-content {
            position: relative;
            overflow: hidden;
            background: white;
            height: calc(100% - 44px);
        }

        .expandable-viz {
            cursor: pointer;
        }

        .expandable-viz:hover {
            transform: scale(1.02);
        }

        .expanded-content {
            display: none;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }

        .expanded-content ul {
            list-style: none;
            padding: 15px;
        }

        .expanded-content ul li {
            margin: 8px 0;
            font-size: 0.9em;
            color: #1D3557;
        }

        /* Modal Styles */
        .visualization-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow: auto;
        }

        .modal-content {
            position: relative;
            background: white;
            margin: 20px auto;
            padding: 20px;
            width: 95%;
            max-width: 1800px;
            height: 90vh;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #1D3557;
            z-index: 1100;
            background: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .close-modal:hover {
            background: #f0f0f0;
            transform: scale(1.1);
        }
        
        .modal-content .visualization-title {
            background: #457B9D;
            color: #F1FAEE;
            padding: 15px;
            margin: -20px -20px 10px -20px;
            font-family: 'Oswald', sans-serif;
            font-size: 1.4em;
            border-radius: 10px 10px 0 0;
        }

        .modal-content .visualization-content {
            flex: 1;
            overflow: hidden;
            margin: 10px 0;
        }

        .modal-content .visualization-iframe {
            width: 100%;
            height: 100%;
            border: none;
            transform: none;
        }

        .modal-content .expanded-content {
            max-height: 150px;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-top: 10px;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Loading states */
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #457B9D;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .viz-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #f8f9fa;
        }

        /* Mobile Optimizations */
        @media screen and (max-width: 768px) {
            /* Navigation */
            .sidebar {
                width: 80%;
                left: -80%;
                max-width: 300px;
            }
            
            .sidebar.show {
                left: 0;
            }
            
            .sidebar a {
                font-size: 1.4em;
                padding: 20px;
            }
            
            .open-btn {
                left: 10px;
                top: 10px;
                width: 50px;
                height: 50px;
            }
            
            /* Header */
            header h1 {
                font-size: 1.8em;
                padding: 10px;
            }
            
            /* Main Content */
            .main-content {
                padding: 20px 15px;
            }
            
            .main-content.active {
                margin-left: 0;
            }
            
            /* Stats */
            .stat-container {
                flex-direction: column;
                align-items: center;
            }
            
            .stat-box {
                width: 100%;
                max-width: 300px;
                margin: 10px 0;
            }
            
            /* Visualizations */
            .visualization-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .visualization-container {
                height: 400px;
                margin-bottom: 15px;
            }
            
            /* Description Boxes */
            .description-box {
                padding: 15px;
                font-size: 1em;
                margin: 20px 10px;
            }
            
            /* Modal for Mobile */
            .modal-content {
                width: 100%;
                height: 100vh;
                margin: 0;
                border-radius: 0;
                padding: 15px;
            }
            
            .close-modal {
                position: fixed;
                right: 15px;
                top: 15px;
                z-index: 1101;
            }
            
            .modal-content .visualization-content {
                height: 60vh;
            }
            
            .modal-content .expanded-content {
                max-height: 20vh;
                font-size: 0.9em;
            }
        }
        
        @media screen and (max-width: 480px) {
            /* Extra small devices */
            header h1 {
                font-size: 1.5em;
            }
            
            .content h2 {
                font-size: 1.8em;
            }
            
            .visualization-container {
                height: 350px;
            }
            
            .stat-box p {
                font-size: 1.8em;
            }
            
            .visualization-title {
                font-size: 1em;
                padding: 12px;
            }
        }
        
        /* Touch-friendly enhancements */
        @media (hover: none) and (pointer: coarse) {
            /* Make clickable areas larger for touch */
            .expandable-viz {
                min-height: 100px;
            }
            
            .viz-placeholder p {
                font-size: 1.2em;
                padding: 20px;
            }
            
            .close-modal {
                width: 50px;
                height: 50px;
                font-size: 35px;
            }
        }
        
        /* Landscape mode adjustments */
        @media screen and (max-width: 768px) and (orientation: landscape) {
            .visualization-container {
                height: 80vh;
            }
            
            .modal-content {
                height: 100vh;
            }
            
            .modal-content .visualization-content {
                height: 70vh;
            }
        }
    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>

    <header>
        <h1>Lake Placid Ironman 2023</h1>
    </header>

    <button class="open-btn" onclick="openNav()">&#9776;</button>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="close-btn" onclick="closeNav()">&#10006;</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'intro')">Intro</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'genetic_analysis')">Genetic Analysis</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'body_composition')">Body Composition</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'swim')">Swim</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'bike')">Bike</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'run')">Run</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'diet_sleep')">Diet & Sleep</a>
        <a href="javascript:void(0)" onclick="openTab(event, 'final_thoughts')">Final Thoughts</a>
    </div>

    <div id="main" class="main-content">
        <!-- Intro Section -->
        <div id="intro" class="content active">
            <h2 class="section-title">Introduction</h2>
            
            <!-- Personal Journey Overview -->
            <div class="description-box">
                <h3>My Ironman Journey</h3>
                <p>Welcome to my Lake Placid Ironman 2023 journey. This project documents my 6-month training and delves into the details of my improvement across 3 athletic events.</p>
            </div>

            <!-- Key Stats -->
            <div class="stat-container">
                <div class="stat-box">
                    <h3>Total Training Days</h3>
                    <p><span class="animate-number" data-value="180">0</span></p>
                    <small>Over 6 months</small>
                </div>
                <div class="stat-box">
                    <h3>Hours Trained</h3>
                    <p><span class="animate-number" data-value="720">0</span></p>
                    <small>~4 hours/day</small>
                </div>
                <div class="stat-box">
                    <h3>Calories Burned</h3>
                    <p><span class="animate-number" data-value="540000">0</span></p>
                    <small>During training</small>
                </div>
                <div class="stat-box">
                    <h3>Total Distance</h3>
                    <p><span class="animate-number" data-value="140">0</span></p>
                    <small>Miles on race day</small>
                </div>
            </div>

            <!-- Course Overview -->
            <div class="course-overview">
                <h3>The Lake Placid Challenge</h3>
                
                <div class="visualization-grid">
                    <div class="visualization-container expandable-viz">
                        <h3 class="visualization-title">Swim Course - Mirror Lake</h3>
                        <div class="visualization-content">
                            <img src="course_maps/IM24_LP_CourseMap_Swim_081423_cc-1_large.webp" alt="Swim Course Map" class="visualization-image" loading="lazy">
                        </div>
                        <div class="expanded-content">
                            <ul>
                                <li>🏊‍♂️ Notes: Very beautiful sunrise as over 2000 athletes prepare for a long day ahead</li>
                                <li>💧 Two 1.2-mile loops</li>
                                <li>🌡️ Average water temp: 68-72°F</li>
                                <li>⏱️ Cut-off time: 2:20</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="visualization-container expandable-viz">
                        <h3 class="visualization-title">Bike Course - Adirondacks</h3>
                        <div class="visualization-content">
                            <img src="course_maps/IM24_LP_CourseMap_Bike_081423_cc-1_large.webp" alt="Bike Course Map" class="visualization-image" loading="lazy">
                        </div>
                        <div class="expanded-content">
                            <ul>
                                <li>🚴‍♂️ Notes: Hilly roads with lots of speed on descents and effort on climbing</li>
                                <li>⛰️ Elevation gain: 6,700 feet</li>
                                <li>🔄 Two 56-mile loops</li>
                                <li>⏱️ Cut-off time: 10:30</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="visualization-container expandable-viz">
                        <h3 class="visualization-title">Run Course - Lake Placid</h3>
                        <div class="visualization-content">
                            <img src="course_maps/IM24_LP_CourseMap_Run_081423_cc-1_large.webp" alt="Run Course Map" class="visualization-image" loading="lazy">
                        </div>
                        <div class="expanded-content">
                            <ul>
                                <li>🏃‍♂️ Notes: Mild hills with large crowds cheering you on</li>
                                <li>⛰️ Elevation gain: 1,500 feet</li>
                                <li>🔄 Two 13.1-mile loops</li>
                                <li>⏱️ Cut-off time: 17:00</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Other sections with lazy loading -->
        <div id="genetic_analysis" class="content">
            <h2>Genetic Analysis</h2>
            <div class="description-box">
                <p>Loading genetic analysis data...</p>
            </div>
            <div class="visualization-grid" id="genetic-viz-grid">
                <!-- Will be loaded dynamically -->
            </div>
        </div>

        <div id="body_composition" class="content">
            <h2>Body Composition</h2>
            <div class="description-box">
                <p>Loading body composition data...</p>
            </div>
            <div class="visualization-grid" id="body-viz-grid">
                <!-- Will be loaded dynamically -->
            </div>
        </div>

        <div id="swim" class="content">
            <h2>Swim Performance</h2>
            <div class="description-box">
                <p>Loading swim performance data...</p>
            </div>
            <div class="visualization-grid" id="swim-viz-grid">
                <!-- Will be loaded dynamically -->
            </div>
        </div>

        <div id="bike" class="content">
            <h2>Bike Performance</h2>
            <div class="description-box">
                <p>Loading bike performance data...</p>
            </div>
            <div class="visualization-grid" id="bike-viz-grid">
                <!-- Will be loaded dynamically -->
            </div>
        </div>

        <div id="run" class="content">
            <h2>Run Performance</h2>
            <div class="description-box">
                <p>Loading run performance data...</p>
            </div>
            <div class="visualization-grid" id="run-viz-grid">
                <!-- Will be loaded dynamically -->
            </div>
        </div>

        <div id="diet_sleep" class="content">
            <h2>Diet & Sleep Analysis</h2>
            <div class="description-box">
                <p>Loading diet and sleep data...</p>
            </div>
            <div class="visualization-grid" id="diet-viz-grid">
                <!-- Will be loaded dynamically -->
            </div>
        </div>

        <div id="final_thoughts" class="content">
            <h2>Final Thoughts</h2>
            <div class="description-box">
                <h3>My Ironman Journey</h3>
                <p>Looking back on training, the data reflects a story of gradual progress and adaptation.</p>
            </div>
            <div class="stat-container">
                <div class="stat-box">
                    <h3>Final Swim Time</h3>
                    <p><span class="animate-number" data-value="01:38:16">0</span></p>
                </div>
                <div class="stat-box">
                    <h3>Final Bike Time</h3>
                    <p><span class="animate-number" data-value="08:05:38">0</span></p>
                </div>
                <div class="stat-box">
                    <h3>Final Run Time</h3>
                    <p><span class="animate-number" data-value="05:02:01">0</span></p>
                </div>
                <div class="stat-box">
                    <h3>Final Finish Time</h3>
                    <p><span class="animate-number" data-value="15:08:56">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Nobel Girmay - Lake Placid Ironman 2023</p>
    </footer>

    <script>
        // Navigation functions
        function openNav() {
            document.getElementById("mySidebar").classList.add("show");
            document.getElementById("main").classList.add("active");
        }

        function closeNav() {
            document.getElementById("mySidebar").classList.remove("show");
            document.getElementById("main").classList.remove("active");
        }

        function openTab(evt, tabName) {
            var i, content;
            
            // Hide all content
            content = document.getElementsByClassName("content");
            for (i = 0; i < content.length; i++) {
                content[i].classList.remove("active");
            }
            
            // Show selected content
            document.getElementById(tabName).classList.add("active");
            
            // Load content if needed
            loadSectionContent(tabName);
            
            // Animate numbers if visible
            animateNumbers();
            
            // Close nav on mobile after selection
            if (isMobile()) {
                setTimeout(closeNav, 300);
            }
        }

        // Number animation
        function animateNumbers() {
            const numbers = document.querySelectorAll('.animate-number:not(.animated)');
            
            numbers.forEach(number => {
                const target = number.getAttribute('data-value');
                if (!target) return;
                
                number.classList.add('animated');
                
                // Handle time format
                if (target.includes(':')) {
                    number.textContent = target;
                    return;
                }
                
                // Handle regular numbers
                const finalValue = parseInt(target.replace(/,/g, ''));
                const duration = 2000;
                const steps = 60;
                const stepValue = finalValue / steps;
                let current = 0;
                let step = 0;
                
                const timer = setInterval(() => {
                    step++;
                    current += stepValue;
                    
                    if (step >= steps) {
                        current = finalValue;
                        clearInterval(timer);
                    }
                    
                    number.textContent = Math.round(current).toLocaleString();
                }, duration / steps);
            });
        }

        // Progress bar
        window.addEventListener('scroll', function() {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById("progressBar").style.width = scrolled + "%";
        });

        // Lazy loading for sections
        const loadedSections = new Set();
        
        function loadSectionContent(sectionName) {
            if (loadedSections.has(sectionName)) return;
            
            // Define content for each section
            const sectionContent = {
                'genetic_analysis': {
                    description: 'This section delves into my genetic makeup based off SNP genotyping. I created an in-house SNP database based on specific genetic markers that influence athletic performance.',
                    visualizations: [
                        { 
                            title: 'Genetic Performance Report', 
                            src: 'assets/visualizations/genetic_analysis/genetic_performance_report.html',
                            description: 'Scores were calculated by taking 20 known gene variations associated with athletic performance via scientific literature and comparing my own SNP data through normalized scoring.'
                        },
                        { 
                            title: 'Athletic Genetics Overview', 
                            src: 'assets/visualizations/genetic_analysis/athletic_genetics_overview_20241024_132540.html',
                            description: 'This detailed overview analyzes key genetic markers that influence athletic performance, including ACTN3 and ACE genes.'
                        }
                    ]
                },
                'body_composition': {
                    description: 'This section explores how my body composition evolved throughout my Ironman training.',
                    visualizations: [
                        { 
                            title: 'Body Fat Percentage Trends', 
                            src: 'assets/visualizations/body_composition/body_fat_percentage_over_time_20241024_134949.html',
                            description: 'Trend analysis of body fat percentage - clear rebound after the event but cleaned up in the following weeks.'
                        },
                        {
                            title: 'Body Mass Evolution',
                            src: 'assets/visualizations/body_composition/body_mass_over_time_20241024_134949.html',
                            description: 'Trend analysis of body mass with added target weight - identical trend but nice to see weight in pounds'
                        },
                        {
                            title: 'Body Mass vs Body Fat',
                            src: 'assets/visualizations/body_composition/comparison_body_mass_body_fat_20241024_134949.html',
                            description: 'Comparative analysis of body mass and body fat percentage relationships. Nothing out of order here.'
                        },
                        {
                            title: 'Lean Body Mass Trends',
                            src: 'assets/visualizations/body_composition/lean_body_mass_over_time_20241024_134949.html',
                            description: 'I noticed the loss of bodyfat but also the loss of muscle mass - I was considerably weaker throughout my lifts'
                        },
                        {
                            title: 'Pro Height Distribution',
                            src: 'assets/visualizations/body_composition/height_distribution_20241024_135255.html',
                            description: 'Height Distribution of pro triathletes'
                        },
                        {
                            title: 'Pro Body Mass Distribution',
                            src: 'assets/visualizations/body_composition/weight_distribution_20241024_135255.html',
                            description: 'Weight Distribution of pro triathletes'
                        },
                        {
                            title: 'Pro Height vs Weight Analysis',
                            src: 'assets/visualizations/body_composition/height_weight_regression_20241024_135255.html',
                            description: 'Comparison between PRO and Rio 2016 Olympian triathletes showing moderate correlation (R²=0.59)'
                        },
                        { 
                            title: 'Heart Rate by Activity', 
                            src: 'assets/visualizations/body_composition/heart_rate_vs_activity_type_20241024_135605.html',
                            description: 'Even though I was super out of breath during swimming, my heart rate was super low - optimal fat burning range'
                        },
                        {
                            title: 'Base Heart Rate Zones',
                            src: 'assets/visualizations/body_composition/heart_rate_zones_20241024_140507.html',
                            description: 'Distribution of training time across base heart rate zones'
                        },
                        {
                            title: 'Karvonen Heart Rate Zones',
                            src: 'assets/visualizations/body_composition/heart_rate_zones_Karvonen_20241024_140347.html',
                            description: 'Based on the Karvonen method I spent 76.8% of my time in Zone 1!'
                        },
                        {
                            title: 'MHR Heart Rate Zones',
                            src: 'assets/visualizations/body_composition/heart_rate_zones_MHR_20241024_140347.html',
                            description: 'Maximum heart rate zones used during training'
                        },
                        {
                            title: 'Time in Zones Analysis',
                            src: 'assets/visualizations/body_composition/time_spent_in_zones_all_20241024_140347.html',
                            description: 'You can zoom in week by week and see how long you were in each heart rate zone'
                        },
                        {
                            title: 'HRV Trends',
                            src: 'assets/visualizations/body_composition/hrv_trend_20241024_141310.html',
                            description: 'Heart rate variability with sharp ups and downs during training - peaks for recovery, troughs for hard days'
                        },
                        { 
                            title: 'VO2 Max Trends', 
                            src: 'assets/visualizations/body_composition/vo2_max_trend_20241024_141609.html',
                            description: 'VO2 max showing the classic "train-adapt-improve" cycle from 55 to 49 then gradual improvement'
                        }
                    ]
                },
                'swim': {
                    description: 'An analysis of my swim performance during the Ironman training, focusing on improvements in pace, distance, and technique.',
                    visualizations: [
                        { 
                            title: 'Performance Metrics', 
                            src: 'assets/visualizations/swim/metrics_comparison.html',
                            description: 'Pro stroke rate was 74.6 vs my 94.0 - much more efficient. Pro body angle was 162.8° vs my 129.7°'
                        },
                        { 
                            title: 'Body Angle Analysis', 
                            src: 'assets/visualizations/swim/body_angle_analysis.html',
                            description: 'My body angle is consistently too low - pro is much more stable keeping hips and shoulders in line'
                        },
                        {
                            title: 'Wrist Angle Analysis',
                            src: 'assets/visualizations/swim/wrist_position_analysis.html',
                            description: 'Pro wrist angle looks like a heartbeat while mine is inconsistent - focus area for technique'
                        },
                        { 
                            title: 'DPS and SWOLF Trends', 
                            src: 'assets/visualizations/swim/avg_dps_swolf_over_time.html',
                            description: 'Clear upward trend in Distance Per Stroke and downward SWOLF showing improved efficiency'
                        },
                        {
                            title: 'Energy Expenditure',
                            src: 'assets/visualizations/swim/calories_burned_total_distance.html',
                            description: 'Correlation of calories burned with total swimming distance'
                        },
                        {
                            title: 'Stroke Analysis',
                            src: 'assets/visualizations/swim/duration_avg_stroke_count_over_time.html',
                            description: 'Longer durations sometimes correspond to lower stroke efficiency'
                        },
                        {
                            title: 'Interval Analysis',
                            src: 'assets/visualizations/swim/interval_distance_stroke_count_over_time.html',
                            description: 'Breakdown of swim intervals by distance and stroke count'
                        },
                        {
                            title: 'Form Analysis Sessions',
                            src: 'swim_viz_handler.html',
                            description: 'Click to view detailed frame-by-frame form analysis (large files - opens in new page)'
                        }
                    ]
                },
                'bike': {
                    description: 'A deep dive into my biking sessions, covering distance, power, and cadence trends throughout training.',
                    visualizations: [
                        {
                            title: 'Activity Distribution',
                            src: 'assets/visualizations/bike/activity_counts.html',
                            description: 'Specific Wahoo workouts - I liked testing power metrics with the 4DP test frequently'
                        },
                        { 
                            title: 'Power Analysis', 
                            src: 'assets/visualizations/bike/avg_power.html',
                            description: 'Steady increase suggests improvements in power output from consistent training'
                        },
                        {
                            title: 'Correlation Analysis',
                            src: 'assets/visualizations/bike/corr_matrix.html',
                            description: 'Normalized power is more relevant to track than average power'
                        },
                        { 
                            title: 'Training Stress Score', 
                            src: 'assets/visualizations/bike/cumulative_tss.html',
                            description: 'TSS helped me know when to ease back - better than just feeling fatigued'
                        },
                        {
                            title: 'Metric Distribution',
                            src: 'assets/visualizations/bike/distribution.html',
                            description: 'Distribution of various biking metrics - speed, power, and cadence'
                        },
                        {
                            title: 'Duration Analysis',
                            src: 'assets/visualizations/bike/duration_distribution.html',
                            description: 'Session duration distributions across different biking workouts'
                        },
                        {
                            title: 'Training Intensity',
                            src: 'assets/visualizations/bike/if_progression.html',
                            description: 'IF clustered around 0.7-0.9 suggesting moderate-intensity zone training'
                        },
                        {
                            title: 'TSS Distribution',
                            src: 'assets/visualizations/bike/tss_distribution.html',
                            description: 'Training Stress Score distribution across different sessions'
                        },
                        {
                            title: 'TSS Over Time',
                            src: 'assets/visualizations/bike/tss_if_over_time.html',
                            description: 'Stable TSS over time with peaks on harder training days'
                        },
                        { 
                            title: 'Weekly Training Load', 
                            src: 'assets/visualizations/bike/weekly_training_load.html',
                            description: 'Nice to see increasing training load as weeks progressed'
                        },
                        {
                            title: 'Workout Comparison',
                            src: 'assets/visualizations/bike/workout_comparison.html',
                            description: 'Apple Watch vs Wahoo tracking - Wahoo is better for bike data'
                        }
                    ]
                },
                'run': {
                    description: 'This section focuses on my running performance, showcasing my progress in speed, endurance, and pacing strategies.',
                    visualizations: [
                        { 
                            title: 'Running Analysis', 
                            src: 'assets/visualizations/run/enhanced_running_data_analysis.html',
                            description: 'Faster paces correlate with lower calories/mile. Higher elevation gains significantly increase calorie burn'
                        },
                        {
                            title: 'Heart Rate and Cadence',
                            src: 'assets/visualizations/run/heart_rate_cadence_over_time.html',
                            description: 'My cadence is 130-140s but was advised 180 is better - tried it once and it felt wrong'
                        },
                        { 
                            title: 'Pace Analysis', 
                            src: 'assets/visualizations/run/pace_distance_over_time.html',
                            description: 'Two outliers: long 50k race at ~11min pace and short run trying 180 steps/min'
                        },
                        {
                            title: 'Weekly Distance',
                            src: 'assets/visualizations/run/weekly_mileage_before_feb_25_2023.html',
                            description: 'Weekly mileage progression leading up to the event'
                        }
                    ]
                },
                'diet_sleep': {
                    description: 'This section covers the impact of my diet and sleep on my overall training performance and recovery.',
                    visualizations: [
                        { 
                            title: 'Macronutrient Distribution', 
                            src: 'assets/visualizations/diet_sleep/ironman_macronutrient_distribution_20241024_130557.html',
                            description: 'Similar diet during training as normal life - Chipotle was my go-to after brutal days'
                        },
                        {
                            title: 'Weight and Calories',
                            src: 'assets/visualizations/diet_sleep/ironman_weight_and_calories_over_time_20241024_130557.html',
                            description: 'Weight decreased steadily while calories stayed same - carb loading before event'
                        },
                        { 
                            title: 'Sleep Analysis', 
                            src: 'assets/visualizations/diet_sleep/sleep_data_analysis_20241024_130520.html',
                            description: 'Sleep quality peaks at 8-9 hours. Best quality for bedtimes between 10 PM and 12 AM'
                        }
                    ]
                }
            };
            
            const content = sectionContent[sectionName];
            if (!content) return;
            
            // Update description
            const section = document.getElementById(sectionName);
            const descBox = section.querySelector('.description-box');
            if (descBox) {
                descBox.innerHTML = `<p>${content.description}</p>`;
            }
            
            // Load visualizations
            const grid = section.querySelector('.visualization-grid');
            if (grid && content.visualizations) {
                grid.innerHTML = '';
                content.visualizations.forEach(viz => {
                    const container = document.createElement('div');
                    container.className = 'visualization-container expandable-viz';
                    container.innerHTML = `
                        <h3 class="visualization-title">${viz.title}</h3>
                        <div class="visualization-content">
                            <div class="viz-placeholder">
                                <div class="loading-spinner"></div>
                                <p>Click to load visualization</p>
                            </div>
                        </div>
                        <div class="expanded-content">
                            <p>${viz.description || 'Click to view detailed analysis'}</p>
                        </div>
                    `;
                    
                    // Load iframe on first click
                    let loaded = false;
                    container.addEventListener('click', function(e) {
                        if (!loaded) {
                            const content = this.querySelector('.visualization-content');
                            content.innerHTML = `<iframe class="visualization-iframe" src="${viz.src}" loading="lazy"></iframe>`;
                            loaded = true;
                        }
                    });
                    
                    grid.appendChild(container);
                });
                
                // Re-initialize expandable functionality for new elements
                setupExpandableVizs();
            }
            
            loadedSections.add(sectionName);
        }

        // Modal functionality for expandable visualizations
        function setupExpandableVizs() {
            const expandableVizs = document.querySelectorAll('.expandable-viz');
            
            expandableVizs.forEach(viz => {
                viz.addEventListener('click', function(e) {
                    // Don't trigger on links inside
                    if (e.target.tagName === 'A') return;
                    
                    const modal = document.createElement('div');
                    modal.className = 'visualization-modal fade-in';
                    
                    const title = this.querySelector('.visualization-title');
                    const content = this.querySelector('.visualization-content');
                    const description = this.querySelector('.expanded-content');
                    
                    // Clone and prepare content
                    const modalContent = content.cloneNode(true);
                    const modalIframe = modalContent.querySelector('iframe');
                    if (modalIframe) {
                        modalIframe.style.width = '100%';
                        modalIframe.style.height = '100%';
                        modalIframe.classList.remove('preview-mode');
                    }
                    
                    modal.innerHTML = `
                        <div class="modal-content">
                            <span class="close-modal">&times;</span>
                            ${title ? title.outerHTML : ''}
                            ${modalContent.outerHTML}
                            ${description ? `<div class="expanded-content" style="display: block;">${description.innerHTML}</div>` : ''}
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    modal.style.display = 'block';
                    document.body.style.overflow = 'hidden';
                    
                    const closeBtn = modal.querySelector('.close-modal');
                    closeBtn.onclick = function() {
                        modal.classList.remove('fade-in');
                        setTimeout(() => {
                            modal.remove();
                            document.body.style.overflow = 'auto';
                        }, 300);
                    };
                    
                    modal.onclick = function(e) {
                        if (e.target === modal) {
                            closeBtn.click();
                        }
                    };
                });
            });
        }

        // Mobile detection
        function isMobile() {
            return window.innerWidth <= 768 || ('ontouchstart' in window);
        }
        
        // Touch swipe support for navigation
        function addSwipeSupport() {
            let touchStartX = 0;
            let touchEndX = 0;
            
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchEndX - touchStartX;
                
                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        // Swipe right - open menu
                        if (!document.getElementById('mySidebar').classList.contains('show')) {
                            openNav();
                        }
                    } else {
                        // Swipe left - close menu
                        if (document.getElementById('mySidebar').classList.contains('show')) {
                            closeNav();
                        }
                    }
                }
            }
        }
        
        // Optimize images for mobile
        function optimizeImagesForMobile() {
            if (isMobile()) {
                const images = document.querySelectorAll('img');
                images.forEach(img => {
                    // Add loading lazy for all images on mobile
                    img.loading = 'lazy';
                    
                    // Reduce quality for mobile if needed
                    if (img.src.includes('.webp')) {
                        img.style.imageRendering = 'auto';
                    }
                });
            }
        }
        
        // Mobile-friendly modal closing
        function setupMobileModalClose() {
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.visualization-modal');
                    modals.forEach(modal => modal.remove());
                    document.body.style.overflow = 'auto';
                }
            });
        }
        
        // Viewport height fix for mobile browsers
        function setViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        // Handle orientation changes
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                setViewportHeight();
                // Recalculate grid layouts
                const grids = document.querySelectorAll('.visualization-grid');
                grids.forEach(grid => {
                    grid.style.opacity = '0.5';
                    setTimeout(() => {
                        grid.style.opacity = '1';
                    }, 100);
                });
            }, 100);
        });
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            animateNumbers();
            setupExpandableVizs();
            
            // Mobile-specific initializations
            if (isMobile()) {
                addSwipeSupport();
                optimizeImagesForMobile();
                setViewportHeight();
            }
            
            setupMobileModalClose();
            
            // Defer loading of heavy libraries
            setTimeout(() => {
                if (!isMobile()) {  // Only load GSAP on desktop
                    const gsap = document.createElement('script');
                    gsap.src = 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js';
                    gsap.defer = true;
                    document.head.appendChild(gsap);
                }
            }, 1000);
        });
        
        // Handle resize events
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                setViewportHeight();
            }, 250);
        });
    </script>
</body>
</html>